<!DOCTYPE html>
<html>
<head>
  <title>Glide Warrior ULTRA</title>
  <style>
    body { margin: 0; }
    canvas { display: block; width: 1280px; height: 720px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="2560" height="1440"></canvas> <!-- High-res for detail -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const playerName = urlParams.get('player') || 'WARRIOR';
    const charType = urlParams.get('char') || 'soldier';
    const diff = urlParams.get('diff') || 'normal';
    const startLevel = parseInt(urlParams.get('level')) || 1;
    const custom = decodeURIComponent(urlParams.get('custom') || '');
    const coop = urlParams.get('coop') === 'true';
    const player2Name = urlParams.get('player2') || 'PLAYER 2';

    let enemySpeed = 1;
    let enemyHealth = 1;
    if (diff === 'easy') { enemySpeed = 0.5; enemyHealth = 0.5; }
    else if (diff === 'hard') { enemySpeed = 1.5; enemyHealth = 1.5; }

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d', { alpha: false, desynchronized: true }); // High-def rendering

    let levels = [
      { width: 3000, platforms: [{x:0,y:600,w:3000,h:120}, {x:500,y:500,w:200,h:20}, {x:1000,y:400,w:300,h:20}], enemies: [{x:800,y:550,type:'basic'}, {x:1500,y:350,type:'basic'}] },
      { width: 4000, platforms: [{x:0,y:600,w:4000,h:120}, {x:300,y:450,w:250,h:20}, {x:1200,y:350,w:400,h:20}], enemies: [{x:1000,y:550,type:'basic'}, {x:2000,y:300,type:'basic'}, {x:3000,y:550,type:'basic'}] },
      { width: 5000, platforms: [{x:0,y:600,w:5000,h:120}, {x:400,y:500,w:300,h:20}, {x:1500,y:400,w:500,h:20}, {x:3000,y:300,w:200,h:20}], enemies: [{x:900,y:550,type:'basic'}, {x:1800,y:350,type:'basic'}, {x:3500,y:250,type:'basic'}] }
    ];

    let level = Math.max(1, Math.min(3, startLevel)) - 1;

    if (custom) {
      try {
        levels[level] = JSON.parse(custom);
      } catch (e) {}
    }

    let cameraX = 0;

    let player = { x: 50, y: 550, vx: 0, vy: 0, width: 40, height: 80, onGround: true, facingRight: true, health: 100, type: charType, anim: 0 };
    let player2 = coop ? { ...player, x: 100, type: 'soldier' } : null;

    let bullets = [];
    let enemies = levels[level].enemies.map(e => ({ ...e, width: 40, height: 80, health: 50 * enemyHealth, vx: -enemySpeed }));

    let keys = {};
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);

    function updatePlayer(p, isP2 = false) {
      const left = isP2 ? 'a' : 'ArrowLeft';
      const right = isP2 ? 'd' : 'ArrowRight';
      const up = isP2 ? 'w' : 'ArrowUp';
      const shoot = isP2 ? 'q' : ' ';

      if (keys[left]) { p.vx = -5; p.facingRight = false; }
      else if (keys[right]) { p.vx = 5; p.facingRight = true; }
      else { p.vx = 0; }

      if (keys[up] && p.onGround) { p.vy = -15; p.onGround = false; }

      p.vy += 0.8; // Gravity
      p.x += p.vx;
      p.y += p.vy;

      p.onGround = false;
      for (let plat of levels[level].platforms) {
        if (p.x + p.width > plat.x && p.x < plat.x + plat.w &&
            p.y + p.height > plat.y && p.y + p.height - p.vy <= plat.y) {
          p.y = plat.y - p.height;
          p.vy = 0;
          p.onGround = true;
        }
      }

      if (p.y + p.height > canvas.height / 2) { // Scale for high-res
        p.y = canvas.height / 2 - p.height;
        p.vy = 0;
        p.onGround = true;
      }

      p.x = Math.max(0, Math.min(levels[level].width - p.width, p.x));

      if (keys[shoot] && !p.shootCooldown) {
        bullets.push({ x: p.x + (p.facingRight ? p.width : 0), y: p.y + 40, vx: p.facingRight ? 10 : -10, owner: isP2 ? 'p2' : 'p1' });
        p.shootCooldown = 10;
        keys[shoot] = false;
      }
      if (p.shootCooldown) p.shootCooldown--;

      if (Math.abs(p.vx) > 0) p.anim += 0.1;
      else p.anim = 0;
    }

    function update() {
      updatePlayer(player);
      if (coop) updatePlayer(player2, true);

      cameraX = Math.max(0, Math.min(Math.max(player.x, coop ? player2.x : 0) - canvas.width / 4, levels[level].width - canvas.width / 2));

      bullets.forEach(b => { b.x += b.vx; });
      bullets = bullets.filter(b => b.x > 0 && b.x < levels[level].width);

      enemies.forEach(e => {
        e.x += e.vx;
        if (e.x < 0 || e.x > levels[level].width - e.width) e.vx = -e.vx;

        bullets.forEach((b, i) => {
          if (b.x > e.x && b.x < e.x + e.width && b.y > e.y && b.y < e.y + e.height) {
            e.health -= 20;
            bullets.splice(i, 1);
          }
        });

        if (e.health <= 0) enemies.splice(enemies.indexOf(e), 1);

        // Player collision with enemy
        if (Math.abs(e.x - player.x) < 40 && Math.abs(e.y - player.y) < 80) player.health -= 0.5;
        if (coop && Math.abs(e.x - player2.x) < 40 && Math.abs(e.y - player2.y) < 80) player2.health -= 0.5;
      });

      if (player.x > levels[level].width - 100 || (coop && player2.x > levels[level].width - 100)) {
        if (level < levels.length - 1) {
          level++;
          enemies = levels[level].enemies.map(e => ({ ...e, width: 40, height: 80, health: 50 * enemyHealth, vx: -enemySpeed }));
          player.x = 50; player.y = 550;
          if (coop) player2.x = 100; player2.y = 550;
        }
      }

      if (player.health <= 0 || (coop && player2.health <= 0)) { /* Game over logic */ }
    }

    function drawCharacter(char, isEnemy = false) {
      ctx.save();
      ctx.translate(char.x, char.y);
      if (!char.facingRight && !isEnemy) {
        ctx.scale(-1, 1);
        ctx.translate(-char.width, 0);
      }

      // Body
      ctx.fillStyle = isEnemy ? '#8B0000' : (char.type === 'soldier' ? '#0047AB' : '#333333'); // Detailed colors
      ctx.fillRect(10, 20, 20, 40);

      // Head
      ctx.fillStyle = isEnemy ? '#FF4500' : '#FFDAB9';
      ctx.beginPath();
      ctx.arc(20, 10, 10, 0, Math.PI * 2);
      ctx.fill();

      // Eyes
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.arc(15, 8, 2, 0, Math.PI * 2);
      ctx.arc(25, 8, 2, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.arc(15, 8, 1, 0, Math.PI * 2);
      ctx.arc(25, 8, 1, 0, Math.PI * 2);
      ctx.fill();

      // Legs with animation
      const legAnim = Math.sin(char.anim) * 10;
      ctx.strokeStyle = isEnemy ? '#4B0000' : '#00008B';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(15, 60);
      ctx.lineTo(15 + legAnim, 80);
      ctx.moveTo(25, 60);
      ctx.lineTo(25 - legAnim, 80);
      ctx.stroke();

      // Arms
      ctx.beginPath();
      ctx.moveTo(10, 30);
      ctx.lineTo(0, 40);
      ctx.moveTo(30, 30);
      ctx.lineTo(40, 35);
      ctx.stroke();

      // Gun with detail
      ctx.fillStyle = '#808080';
      ctx.fillRect(40, 33, 25, 4);
      ctx.fillRect(45, 31, 5, 8); // Grip

      if (char.type === 'ninja') {
        // Ninja scarf
        ctx.fillStyle = '#FF0000';
        ctx.beginPath();
        ctx.moveTo(10, 15);
        ctx.lineTo(30, 15);
        ctx.lineTo(20, 25);
        ctx.fill();
      } else if (char.type === 'soldier') {
        // Helmet
        ctx.fillStyle = '#006400';
        ctx.beginPath();
        ctx.arc(20, 10, 12, Math.PI, 0);
        ctx.fill();
      }

      ctx.restore();
    }

    function draw() {
      ctx.fillStyle = '#87CEEB'; // Sky
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.save();
      ctx.scale(2, 2); // High-def scaling
      ctx.translate(-cameraX / 2, 0);

      // Background details (hills)
      ctx.fillStyle = '#228B22';
      ctx.beginPath();
      ctx.moveTo(0, 600);
      for (let i = 0; i < levels[level].width; i += 200) {
        ctx.quadraticCurveTo(i + 100, 500, i + 200, 600);
      }
      ctx.lineTo(levels[level].width, canvas.height / 2);
      ctx.lineTo(0, canvas.height / 2);
      ctx.fill();

      // Platforms with texture
      levels[level].platforms.forEach(plat => {
        ctx.fillStyle = '#8B4513';
        ctx.fillRect(plat.x, plat.y, plat.w, plat.h);
        ctx.strokeStyle = '#A0522D';
        ctx.lineWidth = 2;
        for (let i = plat.x; i < plat.x + plat.w; i += 10) {
          ctx.beginPath();
          ctx.moveTo(i, plat.y);
          ctx.lineTo(i, plat.y + plat.h);
          ctx.stroke();
        }
      });

      drawCharacter(player);
      if (coop) drawCharacter(player2);

      enemies.forEach(e => drawCharacter(e, true));

      bullets.forEach(b => {
        ctx.fillStyle = '#FFD700';
        ctx.beginPath();
        ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
        ctx.fill();
      });

      // HUD
      ctx.fillStyle = 'black';
      ctx.font = '20px Arial';
      ctx.fillText(`${playerName} Health: ${Math.floor(player.health)}`, cameraX / 2 + 10, 30);
      if (coop) ctx.fillText(`${player2Name} Health: ${Math.floor(player2.health)}`, cameraX / 2 + 10, 60);
      ctx.fillText(`Level: ${level + 1}`, cameraX / 2 + 10, 90);

      ctx.restore();
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
