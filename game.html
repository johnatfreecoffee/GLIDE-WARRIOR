<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Simple Warrior</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body { 
            margin: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            color: #0f0;
        }
        canvas {
            display: block;
            border: 2px solid #0f0;
        }
        #info {
            margin: 10px;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="info">Loading platformer game...</div>
    <script>
        // Get parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const PLAYER_NAME = urlParams.get('player') || 'PLAYER';
        const DIFFICULTY = urlParams.get('diff') || 'easy';
        
        // Difficulty settings
        const settings = {
            easy: { enemySpeed: 1, enemyCount: 2, coinSpeed: 2 },
            normal: { enemySpeed: 2, enemyCount: 3, coinSpeed: 3 },
            hard: { enemySpeed: 3, enemyCount: 4, coinSpeed: 4 }
        };
        
        const diff = settings[DIFFICULTY] || settings.easy;
        
        // Game variables
        let player;
        let platforms = [];
        let coins = [];
        let enemies = [];
        let score = 0;
        let lives = 3;
        let gameState = 'playing';
        let gameTime = 0;
        
        function setup() {
            createCanvas(800, 600);
            
            // Create player
            player = {
                x: 100,
                y: 400,
                w: 30,
                h: 30,
                vx: 0,
                vy: 0,
                speed: 5,
                jumpPower: -12,
                gravity: 0.6,
                onGround: false,
                invincible: 0
            };
            
            // Create platforms
            platforms = [
                { x: 0, y: 550, w: 800, h: 50 }, // Ground
                { x: 200, y: 450, w: 150, h: 20 },
                { x: 450, y: 350, w: 150, h: 20 },
                { x: 300, y: 250, w: 200, h: 20 },
                { x: 600, y: 450, w: 150, h: 20 }
            ];
            
            // Update info
            document.getElementById('info').innerHTML = 
                `Player: ${PLAYER_NAME} | Difficulty: ${DIFFICULTY} | Arrow Keys + SPACE to jump`;
        }
        
        function draw() {
            background(20, 20, 40);
            
            if (gameState === 'playing') {
                updateGame();
            } else {
                showGameOver();
            }
        }
        
        function updateGame() {
            gameTime++;
            
            // Player movement
            if (keyIsDown(LEFT_ARROW)) {
                player.vx = -player.speed;
            } else if (keyIsDown(RIGHT_ARROW)) {
                player.vx = player.speed;
            } else {
                player.vx = 0;
            }
            
            // Apply gravity
            player.vy += player.gravity;
            
            // Update position
            player.x += player.vx;
            player.y += player.vy;
            
            // Platform collision
            player.onGround = false;
            for (let platform of platforms) {
                if (player.x < platform.x + platform.w &&
                    player.x + player.w > platform.x &&
                    player.y + player.h > platform.y &&
                    player.y + player.h < platform.y + platform.h + player.vy) {
                    
                    if (player.vy > 0) { // Falling down
                        player.y = platform.y - player.h;
                        player.vy = 0;
                        player.onGround = true;
                    }
                }
            }
            
            // Keep player in horizontal bounds
            player.x = constrain(player.x, 0, width - player.w);
            
            // Fall off screen = lose life
            if (player.y > height) {
                lives--;
                player.x = 100;
                player.y = 400;
                player.vy = 0;
            }
            
            // Draw platforms
            fill(100, 150, 100);
            stroke(80, 120, 80);
            strokeWeight(2);
            for (let platform of platforms) {
                rect(platform.x, platform.y, platform.w, platform.h);
            }
            
            // Draw player
            if (player.invincible % 10 < 5 || player.invincible === 0) {
                fill(0, 255, 255);
                stroke(0, 200, 200);
                strokeWeight(2);
                rect(player.x, player.y, player.w, player.h);
            }
            
            if (player.invincible > 0) player.invincible--;
            
            // Spawn coins on platforms
            if (gameTime % 180 === 0) {
                let platform = random(platforms.slice(1)); // Skip ground
                coins.push({
                    x: random(platform.x, platform.x + platform.w - 20),
                    y: platform.y - 25,
                    w: 20,
                    h: 20,
                    collected: false
                });
            }
            
            // Update coins
            for (let i = coins.length - 1; i >= 0; i--) {
                let coin = coins[i];
                
                if (!coin.collected) {
                    // Draw coin
                    fill(255, 215, 0);
                    stroke(200, 170, 0);
                    strokeWeight(2);
                    circle(coin.x + coin.w/2, coin.y + coin.h/2, coin.w);
                    
                    // Check collision
                    if (player.x < coin.x + coin.w &&
                        player.x + player.w > coin.x &&
                        player.y < coin.y + coin.h &&
                        player.y + player.h > coin.y) {
                        coin.collected = true;
                        score += 10;
                    }
                } else {
                    coins.splice(i, 1);
                }
            }
            
            // Spawn enemies
            if (gameTime % 240 === 0 && enemies.length < diff.enemyCount) {
                enemies.push({
                    x: width,
                    y: 520,
                    w: 25,
                    h: 25,
                    vx: -diff.enemySpeed,
                    type: 'walker'
                });
            }
            
            // Update enemies
            for (let i = enemies.length - 1; i >= 0; i--) {
                let enemy = enemies[i];
                enemy.x += enemy.vx;
                
                // Draw enemy
                fill(255, 0, 0);
                stroke(200, 0, 0);
                strokeWeight(2);
                rect(enemy.x, enemy.y, enemy.w, enemy.h);
                
                // Check collision with player
                if (player.invincible === 0 &&
                    player.x < enemy.x + enemy.w &&
                    player.x + player.w > enemy.x &&
                    player.y < enemy.y + enemy.h &&
                    player.y + player.h > enemy.y) {
                    
                    lives--;
                    player.invincible = 120; // 2 seconds invincibility
                    
                    // Knockback
                    if (player.x < enemy.x) {
                        player.x -= 30;
                    } else {
                        player.x += 30;
                    }
                }
                
                // Remove if off screen
                if (enemy.x < -enemy.w) {
                    enemies.splice(i, 1);
                }
            }
            
            // Draw HUD
            fill(0, 200);
            noStroke();
            rect(0, 0, width, 60);
            
            fill(255);
            textSize(16);
            textAlign(LEFT);
            text(`Player: ${PLAYER_NAME}`, 10, 25);
            text(`Score: ${score}`, 10, 45);
            text(`Lives: ${lives}`, 250, 25);
            text(`Difficulty: ${DIFFICULTY.toUpperCase()}`, 250, 45);
            
            // Controls
            textAlign(RIGHT);
            text('←→ Move | SPACE Jump', width - 10, 25);
            text('Avoid red enemies!', width - 10, 45);
            
            // Check game over
            if (lives <= 0) {
                gameState = 'gameover';
            }
            
            // Win condition (survive 2 minutes)
            if (gameTime > 60 * 60 * 2) {
                gameState = 'victory';
            }
        }
        
        function showGameOver() {
            background(0);
            
            if (gameState === 'victory') {
                fill(0, 255, 0);
                textSize(48);
                textAlign(CENTER, CENTER);
                text('VICTORY!', width/2, height/2 - 80);
                
                fill(255);
                textSize(24);
                text(`${PLAYER_NAME} survived!`, width/2, height/2 - 30);
            } else {
                fill(255, 0, 0);
                textSize(48);
                textAlign(CENTER, CENTER);
                text('GAME OVER', width/2, height/2 - 80);
                
                fill(255);
                textSize(24);
                text(`${PLAYER_NAME} was defeated!`, width/2, height/2 - 30);
            }
            
            text(`Final Score: ${score}`, width/2, height/2 + 10);
            text(`Difficulty: ${DIFFICULTY}`, width/2, height/2 + 40);
            textSize(16);
            text('Press R to restart', width/2, height/2 + 80);
        }
        
        function keyPressed() {
            if (key === ' ' && gameState === 'playing') {
                if (player.onGround) {
                    player.vy = player.jumpPower;
                }
            }
            
            if (key === 'r' || key === 'R') {
                // Restart game
                score = 0;
                lives = 3;
                coins = [];
                enemies = [];
                gameState = 'playing';
                gameTime = 0;
                player.x = 100;
                player.y = 400;
                player.vx = 0;
                player.vy = 0;
                player.invincible = 0;
            }
        }
    </script>
</body>
</html>
